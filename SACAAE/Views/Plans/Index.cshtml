@model IEnumerable<SACAAE.Models.PlanesDeEstudio>

@{
    ViewBag.Title = "Planes";
    Layout = "~/Views/Shared/Privado.cshtml";
}

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            /* Deshabilitar componentes que no tienen datos cargados */
            $("#sltPlan").prop("disabled", "disabled");
            $("#sltCurso").prop("disabled", "disabled");
            $("#sltGrupo").prop("disabled", "disabled");

            /* Se agregan los option por defecto a los select vacíos */
            itemSltPlan = "<option>Seleccione Sede y Modalidad</option>";
            itemSltCurso = "<option>Seleccione Sede, Modalidad y Plan de Estudio</option>";
            itemSltGrupo = "<option>Seleccione Sede, Modalidad, Plan de Estudio y Curso</option>";

            $("#sltPlan").html(itemSltPlan);
            $("#sltCurso").html(itemSltCurso);
            $("#sltGrupo").html(itemSltGrupo);

            /* Funcion llamada cuando se cambien los valores de las sedes o las modalidades */
            $("#sltModalidad, #sltSede").change(function () {

                var route = "/CursoProfesor/Planes/List/" + $('select[name="sltSede"]').val() + "/" + $('select[name="sltModalidad"]').val();
                //alert(route);

                $.getJSON(route, function (data) {
                    var items = "";
                    $.each(data, function (i, plan) {

                        items += "<option value='" + plan.Value + "'>" + plan.Text + "</option>";
                    });

                    if (items != "") {
                        $("#sltPlan").html(items);
                        $("#sltPlan").prepend("<option value='' selected='selected'>-- Seleccionar Plan --</option>");
                        $("#sltPlan").prop("disabled", false);
                    }
                    else {
                        $("#sltPlan").html("<option>No hay planes para esa sede y modalidad</option>");
                    }
                });
            });
            /* Funcion llamada cuando se cambien los valores del plan */
            
            $("#sltPlan").change(function () {
                var id = $('select[name="sltPlan"]').val();
                /*
                var $newLinkTarget = $('@Html.ActionLink("Ver Bloque", "BloqueXPlan")'); 
                var href = $newLinkTarget.attr('href') + '?plan=' + id;
                $newLinkTarget.attr('href', href);
                $("#bloquesLink").html($newLinkTarget);*/
                if (id != '') {
                    $("#verBloques").prop("disabled", false);
                }
                else
                    $("#verBloques").prop("disabled", true);
            });
        });
        
    </script>

}



    <h2>Planes de Estudio</h2>
        @if (TempData.ContainsKey("MessageError"))
        {
            <p class="text-danger">@TempData["MessageError"].ToString()</p>
        }
        @if (TempData.ContainsKey("MessageSuccess"))
        {
            <p class="text-success">@TempData["MessageSuccess"].ToString()</p>
        }
            @using (Html.BeginForm())
{
     <div class="row-fluid">
    <div class="col-lg-5">
        <div class="span12">
        <p>
            @Html.ActionLink("Agregar Nuevo", "CrearPlan")
        </p>
         <label>
                    Sede
                </label>
                    <select id="sltSede" name="sltSede" class="form-control">
                        @if (ViewBag.Sedes != null)
                        {
                            <option value=" " selected="selected">-- Seleccionar Sede --</option>
                            foreach (var item in ViewBag.Sedes)
                            {         
                            <option value="@item.ID">@item.Nombre</option>
                            }
                        }
                        else
                        {
                            <option selected="selected">No hay sedes</option>
                        }

                    </select>
                    @if (ViewBag.Sedes == null)
                    {                    
                        @Html.ActionLink("Agregar Sede", "Crear", "Sede")
                    }       
            
                <label>
                    Modalidad
                </label>
                    <select id="sltModalidad" name="sltModalidad" class="form-control">
                        @if (ViewBag.Modalidades != null)
                        {
                            <option value=" " selected="selected">-- Seleccionar Modalidad --</option>
                            foreach (var item in ViewBag.Modalidades)
                            {         
                            <option value="@item.ID">@item.Nombre</option>
                            }
                        }
                        else
                        {
                            <option selected="selected">No hay modalidades</option>
                        }

                    </select>
                    @if (ViewBag.Modalidades == null)
                    {                    
                        @Html.ActionLink("Agregar Modalidad", "Crear", "Modalidad")
                    }
            
                <label>
                    Plan de Estudio
                </label>
                    <select id="sltPlan" name="sltPlan" class="form-control">
                    </select>
            <br />
            <div class="editor-field">
            <input name="button" id="verBloques" type="submit" value="Ver Bloques" class="btn btn-default"  disabled/>
        </div>
    </div>
    </div>
        </div>
<br />
    }
